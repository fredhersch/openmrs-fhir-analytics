
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://example.com/foo/getting_started/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../advanced_guides/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.23">
    
    
      
        <title>Getting Started - FHIR Data Pipes Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="FHIR Data Pipes Docs" class="md-header__button md-logo" aria-label="FHIR Data Pipes Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FHIR Data Pipes Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting Started
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../advanced_guides/" class="md-tabs__link">
        
  
    
  
  Advanced Guides

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../tutorial_single_machine/" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../support/" class="md-tabs__link">
          
  
  Community

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="FHIR Data Pipes Docs" class="md-nav__button md-logo" aria-label="FHIR Data Pipes Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    FHIR Data Pipes Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#set-up-fhir-data-pipes" class="md-nav__link">
    <span class="md-ellipsis">
      Set-up FHIR Data Pipes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-the-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Run the pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Common parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fhir-search-input-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      FHIR-Search input parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jdbc-input-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      JDBC input parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parquet-output-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parquet output parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fhir-output-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      FHIR output parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-note-about-beam-runners" class="md-nav__link">
    <span class="md-ellipsis">
      A note about Beam runners
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-configurations" class="md-nav__link">
    <span class="md-ellipsis">
      Example configurations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example configurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fhir-search-to-parquet-files" class="md-nav__link">
    <span class="md-ellipsis">
      FHIR Search to Parquet files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hapi-fhir-jdbc-to-a-fhir-server" class="md-nav__link">
    <span class="md-ellipsis">
      HAPI FHIR JDBC to a FHIR server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-query-the-data-warehouse" class="md-nav__link">
    <span class="md-ellipsis">
      How to query the data warehouse
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-machine-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Single Machine Deployment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Single Machine Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced_guides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Guides
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_single_machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Single Machine Deployment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_add_dashboard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualize Parquet DWH with Apache Superset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_lossy_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RDBMS DWH using FHIR ViewDefinitions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Community
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Community
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release process
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="getting-started">Getting Started</h1>
<p>In this section we will run through concepts related to FHIR Data Pipes and instructions for getting started quickly.</p>
<p>If you are looking for a quick evaluation or prefer to deploy via docker image, check out the <a href="link_here">single machine deployment section</a> which uses a pre-configured docker image and instructions for setting up an end-to-end deployment.</p>
<h2 id="set-up-fhir-data-pipes">Set-up FHIR Data Pipes</h2>
<p>The <a href="https://github.com/google/fhir-data-pipes/blob/master/pipelines/">pipelines</a> directory contains code to transform data from a FHIR source
to either <a href="https://parquet.apache.org">Apache Parquet files</a> for analysis or another FHIR store for data integration.</p>
<p><a href="https://github.com/google/fhir-data-pipes/wiki/OpenMRS-Pipelines-(deprecated)">See this page if you are using OpenMRS</a>.</p>
<p>Reading data from a FHIR Source</p>
<p>The following options are supported for reading the FHIR source data (input data):</p>
<ul>
<li>
<p><em>FHIR-Search</em>: This mode uses FHIR Search APIs to select resources to
    copy, retrieves them as FHIR resources, and transfers the data via FHIR APIs
    or Parquet files. This mode should work with any FHIR server or Facade that has an FHIR Search API end-point</p>
</li>
<li>
<p><em>ndjson</em>: This mode uses ndjson bundles as inputs into the Pipeline. These could be generated using the Bulk Export API or other data transformation methods</p>
</li>
<li>
<p><em>JDBC</em>: This mode uses the <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/jdbc/">Java Database Connectivity (JDBC)
    API</a> to read
    FHIR resources directly from the database of a <a href="https://github.com/hapifhir/hapi-fhir-jpaserver-starter#postgresql-configuration">HAPI FHIR server configured to use a PostgreSQL
    database</a>
    or an <a href="https://openmrs.org/">OpenMRS</a> instance using MySQL.
    Note: JDBC support beyond HAPI FHIR and OpenMRS is not currently
    planned. Our long-term approach for a generic high-throughput alternative is to use
    the <a href="https://build.fhir.org/ig/HL7/bulk-data/export.html">FHIR Bulk Export API</a>.</p>
</li>
</ul>
<p>There are two options for transforming the data (output):</p>
<ul>
<li><em>"Lossless" schema as Parquet files</em>: Outputs the FHIR resources as Parquet files, using the
    <a href="https://github.com/FHIR/sql-on-fhir/blob/master/sql-on-fhir.md">SQL-on-FHIR schema</a>.</li>
<li><em>FHIR</em>: Copies the FHIR resources to another FHIR server using FHIR APIs.</li>
</ul>
<h2 id="setup">Setup</h2>
<p><a href="https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/cloning-a-repository">Clone</a> the <a href="https://github.com/google/fhir-data-pipes">FHIR Data Pipes</a> project to your machine.
Set the <code>utils</code> directory to world-readable: <code>chmod -R 755 ./utils</code>.
Build binaries by running <code>mvn clean install</code> from the root directory of the repository.</p>
<h2 id="run-the-pipeline">Run the pipeline</h2>
<p>Run the pipeline directly using the <code>java</code> command:</p>
<div class="highlight"><span class="filename">run pipeline</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">java</span><span class="w"> </span><span class="o">-</span><span class="n">cp</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">pipelines</span><span class="o">/</span><span class="n">batch</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="n">bundled</span><span class="o">-</span><span class="mf">0.1.0</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="p">.</span><span class="na">jar</span><span class="w"> </span><span class="err">\</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="n">org</span><span class="p">.</span><span class="na">openmrs</span><span class="p">.</span><span class="na">analytics</span><span class="p">.</span><span class="na">FhirEtl</span><span class="w"> </span><span class="err">\</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="o">--</span><span class="n">fhirServerUrl</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="c1">//example.org/fhir \</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="o">--[</span><span class="n">see</span><span class="w"> </span><span class="n">additional</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">below</span><span class="o">]</span>
</code></pre></div>
<p>Add the necessary parameters depending on your use case. The methods used for reading
the source FHIR server and outputting the data depend on the parameters used. You can output to both Parquet files and a FHIR server by including the required parameters for both.</p>
<h2 id="parameters">Parameters</h2>
<p>This section documents the parameters used by the various pipelines. For more
information on parameters, see [TO DO: Add page]
<a href="https://github.com/google/fhir-data-pipes/blob/master/pipelines/batch/src/main/java/org/openmrs/analytics/FhirEtlOptions.java"><code>FhirEtlOptions</code></a>.</p>
<h3 id="common-parameters">Common parameters</h3>
<p>These parameters are used regardless of other pipeline options.</p>
<ul>
<li><code>fhirServerUrl</code> - The base URL of the source FHIR server. Required.</li>
<li><code>fhirServerUserName</code> - The HTTP Basic Auth username to access the FHIR
        server APIs. Default: <code>admin</code></li>
<li><code>fhirServerPassword</code> - The HTTP Basic Auth password to access the FHIR
    server APIs. Default: <code>Admin123</code></li>
<li><code>resourceList</code> - A comma-separated list of <a href="https://www.hl7.org/fhir/resourcelist.html">FHIR
    resources</a> to include in the
    pipeline. Default: <code>Patient,Encounter,Observation</code></li>
<li><code>runner</code> - <a href="https://beam.apache.org/documentation/runners/capability-matrix/">The Apache Beam
    Runner</a>
    to use. Pipelines supports DirectRunner and FlinkRunner by default; other
    runners can be enabled by Maven profiles, e.g., <a href="https://github.com/google/fhir-data-pipes/blob/16fcc255cef4d2708b9941a854e6c638b2533d45/pipelines/batch/pom.xml#L257">DataflowRunner</a>. Default: <code>DirectRunner</code></li>
</ul>
<h3 id="fhir-search-input-parameters">FHIR-Search input parameters</h3>
<p>The pipeline will use FHIR-Search to fetch data as long as <code>jdbcModeEnabled</code> is
unset or false.</p>
<ul>
<li><code>batchSize</code> - The number of resources to fetch in each API call. Default:
    <code>100</code></li>
</ul>
<h3 id="jdbc-input-parameters">JDBC input parameters</h3>
<p>JDBC mode is used if <code>jdbcModeEnabled=true</code>.</p>
<p>To use JDBC mode, first create a copy of
<a href="https://github.com/google/fhir-data-pipes/blob/master/utils/hapi-postgres-config.json">hapi-postgres-config.json</a>
and edit the values to match your database server.</p>
<p>Next, include the following parameters:</p>
<ul>
<li><code>jdbcModeEnabled=true</code></li>
<li><code>fhirDatabaseConfigPath=./path/to/config.json</code></li>
</ul>
<p>If you are using a HAPI FHIR server, also include:</p>
<ul>
<li><code>jdbcModeHapi=true</code></li>
<li><code>jdbcDriverClass=org.postgresql.Driver</code></li>
</ul>
<p>All JDBC parameters:</p>
<ul>
<li><code>jdbcModeEnabled</code> - If true, uses JDBC mode. Default: <code>false</code></li>
<li><code>fhirDatabaseConfigPath</code> - Path to the FHIR database config for JDBC mode.
    Default: <code>../utils/hapi-postgres-config.json</code></li>
<li><code>jdbcModeHapi</code> - If true (with <code>jdbcModeEnabled</code>), uses JDBC mode for a HAPI
    source server. Default: <code>false</code></li>
<li><code>jdbcFetchSize</code> - The fetch size of each JDBC database query. Default:
    <code>10000</code></li>
<li><code>jdbcMaxPoolSize</code> - The maximum number of database connections. Default:
    <code>50</code></li>
<li><code>jdbcDriverClass</code> - The JDBC driver to use. Should be set to
    <code>org.postgresql.Driver</code> for HAPI FHIR Postgres access. Default:
    <code>com.mysql.cj.jdbc.Driver</code></li>
</ul>
<h3 id="parquet-output-parameters">Parquet output parameters</h3>
<p>Parquet files are output when <code>outputParquetPath</code> is set.</p>
<ul>
<li><code>outputParquetPath</code> - The file path to write Parquet files to, e.g.,
    <code>./tmp/parquet/</code>. Default: empty string, which does not output Parquet files.</li>
<li><code>secondsToFlushParquetFiles</code> - The number of seconds to wait before flushing
    all Parquet writers with non-empty content to files. Use <code>0</code> to disable.
    Default: <code>3600</code>.</li>
<li><code>rowGroupSizeForParquetFiles</code> - The approximate size in bytes of the
    row-groups in Parquet files. When this size is reached, the content is
    flushed to disk. This is not used if there are less than 100 records. Use
    <code>0</code> to use the default Parquet row-group size. Default: <code>0</code>.</li>
</ul>
<h3 id="fhir-output-parameters">FHIR output parameters</h3>
<p>Resources will be copied to the FHIR server specified in <code>fhirSinkPath</code>
if that field is set.</p>
<ul>
<li><code>fhirSinkPath</code> - A base URL to a target FHIR server, or the relative path of
    a GCP FHIR store, e.g. <code>http://localhost:8091/fhir</code> for a FHIR server or
    <code>projects/PROJECT/locations/LOCATION/datasets/DATASET/fhirStores/FHIR-STORE-NAME</code>
    for a GCP FHIR store. If using a GCP FHIR store,
    <a href="https://github.com/google/fhir-data-pipes/wiki/Create-a-Google-Cloud-FHIR-Store-and-BigQuery-Dataset">see here for setup information</a>.
    default: none, resources are not copied</li>
<li><code>sinkUserName</code> - The HTTP Basic Auth username to access the FHIR sink. Not
    used for GCP FHIR stores.</li>
<li><code>sinkPassword</code> - The HTTP Basic Auth password to access the FHIR sink. Not
    used for GCP FHIR stores.</li>
</ul>
<h3 id="a-note-about-beam-runners">A note about Beam runners</h3>
<p>If the pipeline is run on a single machine (i.e., not on a distributed cluster), for large datasets consider using a production grade runner like Flink. </p>
<p>This can be done by adding the parameter <code>--runner=FlinkRunner</code> (use <code>--maxParallelism</code> and <code>--parallelism</code> to control parallelism). This should not give a significant run time improvement but may
avoid some of the memory issues of <code>DirectRunner</code>.</p>
<p>[To-do: Read more in the “Apache Beam Runners” guide]</p>
<h2 id="example-configurations">Example configurations</h2>
<p>These examples are set up to work with <a href="https://github.com/google/fhir-data-pipes/wiki/Try-the-pipelines-using-local-test-servers">local test servers</a>.</p>
<h3 id="fhir-search-to-parquet-files">FHIR Search to Parquet files</h3>
<p>Example run:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>java<span class="w"> </span>-cp<span class="w"> </span>./pipelines/batch/target/batch-bundled-0.1.0-SNAPSHOT.jar<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span>org.openmrs.analytics.FhirEtl<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span>--fhirServerUrl<span class="o">=</span>http://localhost:8091/fhir<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span>--outputParquetPath<span class="o">=</span>/tmp/TEST/<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span>--resourceList<span class="o">=</span>Patient,Encounter,Observation
</code></pre></div>
<h3 id="hapi-fhir-jdbc-to-a-fhir-server">HAPI FHIR JDBC to a FHIR server</h3>
<p>Example run:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>java<span class="w"> </span>-cp<span class="w"> </span>./pipelines/batch/target/batch-bundled-0.1.0-SNAPSHOT.jar<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span>org.openmrs.analytics.FhirEtl<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span>--fhirServerUrl<span class="o">=</span>http://localhost:8091/fhir<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span>--resourceList<span class="o">=</span>Patient,Encounter,Observation<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span>--fhirDatabaseConfigPath<span class="o">=</span>./utils/hapi-postgres-config.json<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span>--jdbcModeEnabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span>--jdbcModeHapi<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span>--jdbcMaxPoolSize<span class="o">=</span><span class="m">50</span><span class="w"> </span>--jdbcFetchSize<span class="o">=</span><span class="m">1000</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span>--jdbcDriverClass<span class="o">=</span>org.postgresql.Driver<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span>--fhirSinkPath<span class="o">=</span>http://localhost:8099/fhir<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span>--sinkUserName<span class="o">=</span>hapi<span class="w"> </span>--sinkPassword<span class="o">=</span>hapi
</code></pre></div>
<h2 id="how-to-query-the-data-warehouse">How to query the data warehouse</h2>
<p>To query Parquet files, load them into a compatible data engine such as Apache Spark.</p>
<p>The <a href="https://github.com/google/fhir-data-pipes/wiki/Analytics-on-a-single-machine-using-Docker">single machine Docker Compose configuration</a>
runs the pipeline and loads data into an Apache Spark Thrift server for you.</p>
<h2 id="single-machine-deployment">Single Machine Deployment</h2>
<p>The easiest way to get started is to set up a [single machine deployment] using a docker image provided in the repository.</p>
<p>By default we use the Basic "Single Machine"  <a href="https://github.com/google/fhir-data-pipes/blob/master/docker/compose-controller-spark-sql-
single.yaml">Docker Compose Configuration</a>. For descriptions of the different available compose configurations see <a href="link_to_section">here</a></p>
<p>By default, the Single Machine docker compose configuration will:</p>
<ul>
<li>Bring up the FHIR Pipelines Controller plus a Spark Thrift Server</li>
<li>Start the Web Control Panel for interacting with the Controller for running full and incremental Pipelines and registering new views</li>
<li>Generate Parquet files for in the /docker/dwh directory </li>
<li>Run the SQL-on-FHIR queries defined in /config/views/*.sql and register these via the Thrift Server</li>
<li>Generate flattened views (defined in /config/views/*.json) in the database configured by sinkDbConfigPath (you will need to ensure the database is created)</li>
</ul>
<p>The rest of this guide covers setting up and deploying an end-to-end environment for running analytics queries on FHIR Data. It includes optional instructions for provisioning a FHIR Server with sample data.</p>
<p>To learn how the Pipelines Controller works on its own, go to the FHIR FHIR Pipelines Controller.</p>
<h3 id="requirements">Requirements</h3>
<ul>
<li>Docker - If you are using Linux, Docker must be in sudoless mode</li>
<li>Docker Compose</li>
<li>The FHIR Data Pipes repository, cloned onto the host machine</li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Home
              </div>
            </div>
          </a>
        
        
          
          <a href="../advanced_guides/" class="md-footer__link md-footer__link--next" aria-label="Next: Advanced Guides">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Advanced Guides
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024 Google Health Open Health Stack

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "navigation.footer"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ebd0bdb7.min.js"></script>
      
    
  </body>
</html>